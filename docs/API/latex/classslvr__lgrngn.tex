\doxysection{slvr\+\_\+lgrngn\texorpdfstring{$<$}{<} ct\+\_\+params\+\_\+t \texorpdfstring{$>$}{>}}
\hypertarget{classslvr__lgrngn}{}\label{classslvr__lgrngn}\index{slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}}


Lagrangian solver class coupling Eulerian fields with super-\/droplet model.  




{\ttfamily \#include $<$slvr\+\_\+lgrngn.\+hpp$>$}

\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classslvr__lgrngn_ada814daab71136009cd79a125806d770}{slvr\+\_\+lgrngn}} (typename parent\+\_\+t\+::ctor\+\_\+args\+\_\+t args, const rt\+\_\+params\+\_\+t \&p)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{classslvr__lgrngn_afb20af5a79d3cea26edc0e44e84cf4b8}{alloc}} (typename parent\+\_\+t\+::mem\+\_\+t \texorpdfstring{$\ast$}{*}mem, const int \&n\+\_\+iters)
\begin{DoxyCompactList}\small\item\em Allocate memory for solver arrays. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classslvr__lgrngn_a0c4eb43ff0974f69fa17cea3655d4e1d}\label{classslvr__lgrngn_a0c4eb43ff0974f69fa17cea3655d4e1d} 
void {\bfseries diag\+\_\+rc} ()
\begin{DoxyCompactList}\small\item\em Diagnostic\+: update cloud water mixing ratio from superdroplets. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classslvr__lgrngn_a929c296e24f20ac45e880c2484d382a4}{hook\+\_\+ante\+\_\+loop}} (int nt)
\begin{DoxyCompactList}\small\item\em Hook called before time loop starts. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classslvr__lgrngn_adfdf0b5348ce51a4602daabfeff41d6b}{hook\+\_\+ante\+\_\+step}} ()
\begin{DoxyCompactList}\small\item\em Hook called before each time step. \end{DoxyCompactList}\item 
\Hypertarget{classslvr__lgrngn_a459f1d4c7851b5696c9e40548d522190}\label{classslvr__lgrngn_a459f1d4c7851b5696c9e40548d522190} 
void {\bfseries hook\+\_\+ante\+\_\+delayed\+\_\+step} ()
\begin{DoxyCompactList}\small\item\em Hook called before delayed step operations. \end{DoxyCompactList}\item 
\Hypertarget{classslvr__lgrngn_a24b957d4dc568273fc190be7afec8eca}\label{classslvr__lgrngn_a24b957d4dc568273fc190be7afec8eca} 
void {\bfseries hook\+\_\+mixed\+\_\+rhs\+\_\+ante\+\_\+step} ()
\begin{DoxyCompactList}\small\item\em Hook called before computing RHS in mixed solver. \end{DoxyCompactList}\item 
\Hypertarget{classslvr__lgrngn_a40795a9627b6cc603182ad3e140280d8}\label{classslvr__lgrngn_a40795a9627b6cc603182ad3e140280d8} 
void {\bfseries hook\+\_\+mixed\+\_\+rhs\+\_\+ante\+\_\+loop} ()
\begin{DoxyCompactList}\small\item\em Hook called before loop in mixed RHS solver (initial diagnostics). \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$class ct\+\_\+params\+\_\+t$>$\newline
class slvr\+\_\+lgrngn$<$ ct\+\_\+params\+\_\+t $>$}
Lagrangian solver class coupling Eulerian fields with super-\/droplet model. 

Template specialization depends on the chosen SGS (subgrid-\/scale) scheme.


\begin{DoxyTemplParams}{Template Parameters}
{\em ct\+\_\+params\+\_\+t} & compile-\/time parameters \\
\hline
\end{DoxyTemplParams}


\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classslvr__lgrngn_ada814daab71136009cd79a125806d770}\index{slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}!slvr\_lgrngn@{slvr\_lgrngn}}
\index{slvr\_lgrngn@{slvr\_lgrngn}!slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}}
\doxysubsubsection{\texorpdfstring{slvr\_lgrngn()}{slvr\_lgrngn()}}
{\footnotesize\ttfamily \label{classslvr__lgrngn_ada814daab71136009cd79a125806d770} 
template$<$class ct\+\_\+params\+\_\+t$>$ \\
\mbox{\hyperlink{classslvr__lgrngn}{slvr\+\_\+lgrngn}} (\begin{DoxyParamCaption}\item[{typename parent\+\_\+t\+::ctor\+\_\+args\+\_\+t}]{args}{, }\item[{const rt\+\_\+params\+\_\+t \&}]{p}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em args} & constructor arguments passed to parent solver \\
\hline
{\em p} & runtime parameters \\
\hline
\end{DoxyParams}


\doxysubsection{Member Function Documentation}
\Hypertarget{classslvr__lgrngn_afb20af5a79d3cea26edc0e44e84cf4b8}\index{slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}!alloc@{alloc}}
\index{alloc@{alloc}!slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}}
\doxysubsubsection{\texorpdfstring{alloc()}{alloc()}}
{\footnotesize\ttfamily \label{classslvr__lgrngn_afb20af5a79d3cea26edc0e44e84cf4b8} 
template$<$class ct\+\_\+params\+\_\+t$>$ \\
static void alloc (\begin{DoxyParamCaption}\item[{typename parent\+\_\+t\+::mem\+\_\+t \texorpdfstring{$\ast$}{*}}]{mem}{, }\item[{const int \&}]{n\+\_\+iters}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Allocate memory for solver arrays. 


\begin{DoxyParams}{Parameters}
{\em mem} & memory manager \\
\hline
{\em n\+\_\+iters} & number of iterations \\
\hline
\end{DoxyParams}
\Hypertarget{classslvr__lgrngn_a929c296e24f20ac45e880c2484d382a4}\index{slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}!hook\_ante\_loop@{hook\_ante\_loop}}
\index{hook\_ante\_loop@{hook\_ante\_loop}!slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}}
\doxysubsubsection{\texorpdfstring{hook\_ante\_loop()}{hook\_ante\_loop()}}
{\footnotesize\ttfamily \label{classslvr__lgrngn_a929c296e24f20ac45e880c2484d382a4} 
template$<$class ct\+\_\+params\+\_\+t$>$ \\
void hook\+\_\+ante\+\_\+loop (\begin{DoxyParamCaption}\item[{int}]{nt}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Hook called before time loop starts. 

Prepares the super-\/droplet microphysics model before the main time-\/stepping loop.


\begin{DoxyParams}{Parameters}
{\em nt} & Current number of timesteps.\\
\hline
\end{DoxyParams}
This function performs several critical steps before the simulation loop\+:
\begin{DoxyEnumerate}
\item Sets flags and options for microphysics.
\item Initializes domain and grid parameters for the super-\/droplet model (nx, ny, dx, dy, nz, dz).
\item Computes the maximum number of super-\/droplets ({\ttfamily n\+\_\+sd\+\_\+max}) per cell based on initial SD concentration, dry size distributions, and relaxation sources. Special adjustments are made for large tails, multiple CUDA devices, or distributed memory.
\item Creates the {\ttfamily prtcls} (super-\/droplet) object using the {\ttfamily libcloudphxx\+::lgrngn} factory.
\item Initializes temporary arrays for air density ({\ttfamily rhod}) and pressure ({\ttfamily p\+\_\+e}) to allow super-\/droplet initialization over a 1D profile.
\item Calls {\ttfamily prtcls-\/\texorpdfstring{$>$}{>}init()} to initialize the particle arrays with the thermodynamic and microphysical state.
\item Records microphysics configuration parameters.
\end{DoxyEnumerate}

\begin{DoxyNote}{Note}

\begin{DoxyItemize}
\item The function uses MPI-\/style barriers ({\ttfamily mem-\/\texorpdfstring{$>$}{>}barrier()}) to synchronize ranks during parallel initialization.
\item {\ttfamily rank == 0} is responsible for assertions, setting up options, and recording auxiliary data.
\item CUDA backend-\/specific options are adjusted automatically, including async mode.
\item Microphysics options are recorded into groups like "{}lgrngn"{} and "{}user\+\_\+params"{}. 
\end{DoxyItemize}
\end{DoxyNote}
\Hypertarget{classslvr__lgrngn_adfdf0b5348ce51a4602daabfeff41d6b}\index{slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}!hook\_ante\_step@{hook\_ante\_step}}
\index{hook\_ante\_step@{hook\_ante\_step}!slvr\_lgrngn$<$ ct\_params\_t $>$@{slvr\_lgrngn$<$ ct\_params\_t $>$}}
\doxysubsubsection{\texorpdfstring{hook\_ante\_step()}{hook\_ante\_step()}}
{\footnotesize\ttfamily \label{classslvr__lgrngn_adfdf0b5348ce51a4602daabfeff41d6b} 
template$<$class ct\+\_\+params\+\_\+t$>$ \\
void hook\+\_\+ante\+\_\+step (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}



Hook called before each time step. 

Performs tasks before each simulation timestep in the Lagrangian microphysics solver.

This function is called at the beginning of each timestep. It executes the parent class hook. It performs a sanity check to ensure that the water vapor field ({\ttfamily rv}) has no negative values. 